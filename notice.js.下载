/*============================================
 *
 *               userNotice()
 *
 *=============================================
 *
 * Set up a special notice with a cookie.
 *
 */


function noticeInit() {

    // Add notice
    userNotice('setup-guide', '/_setupguide', 'See the setup guide for this theme');

}

function userNotice(name, url, text, position) {

    function getCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function setCookie(name, value, days) {
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            var expires = "; expires=" + date.toUTCString();
        } else var expires = "";
        document.cookie = name + "=" + value + expires + "; path=/";
    }

    if (typeof(position) === 'undefined') {
        position = 'bottom';
    }

    var notice_name = name + '-notice';
    var notice_name_id = '#' + notice_name;

    var noticeHTML = '<div id="' + notice_name + '" class="notice pos-' + position + '"><p><a href="' + url + '" target="_blank" class="notice-link">' + text + '</a><a href="#" class="notice-close">close notice</a></p></div>';

    if ($('html').hasClass(notice_name) && getCookie(notice_name) != 'hide') {
        $('body')
            .append(noticeHTML)
            .on('click', notice_name_id + ' .notice-close', function (e) {
                e.preventDefault();
                $(notice_name_id).fadeOut('', function () {
                    setCookie(notice_name, 'hide', 40);
                });
            });
    }

}
